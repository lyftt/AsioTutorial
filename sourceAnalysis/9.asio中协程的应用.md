# Asio中协程的应用

## 定时器demo
```C++
#include <asio.hpp>
#include <asio/use_awaitable.hpp>
#include <iostream>
#include <chrono>

using namespace asio;
using namespace std::chrono_literals; // 启用时间字面量（如 1s）

// 定义一个协程函数，每隔1秒打印一次时间，共执行3次
awaitable<void> timer_demo(asio::io_context& io) {
    asio::steady_timer timer(io); // 创建定时器，绑定到io_context

    for (int i = 0; i < 3; ++i) {
        timer.expires_after(1s);  // 设置1秒后触发
        co_await timer.async_wait(use_awaitable); // 异步等待，挂起协程

        auto now = std::chrono::system_clock::now();
        std::time_t now_c = std::chrono::system_clock::to_time_t(now);
        std::cout << "定时触发: " << std::ctime(&now_c); // 打印当前时间
    }
}

int main() {
    asio::io_context io; // 创建IO上下文

    // 将协程绑定到io_context并启动
    co_spawn(io, [&] { return timer_demo(io); }, detached);

    io.run(); // 运行事件循环，直到所有异步操作完成

    return 0;
}
```






